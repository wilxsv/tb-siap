<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ReportePacientesDerivados" language="groovy" printOrder="Horizontal" pageWidth="792" pageHeight="608" orientation="Landscape" whenNoDataType="NoDataSection" columnWidth="782" leftMargin="5" rightMargin="5" topMargin="5" bottomMargin="5" uuid="dd34a8b8-5625-494c-b084-2af1df25676a">
	<property name="ireport.zoom" value="1.3310000000000004"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="fecha_inicio" class="java.lang.String">
		<defaultValueExpression><![CDATA["2016-01-01"]]></defaultValueExpression>
	</parameter>
	<parameter name="fecha_fin" class="java.lang.String">
		<defaultValueExpression><![CDATA["2016-12-01"]]></defaultValueExpression>
	</parameter>
	<parameter name="fecha_consulta" class="java.lang.String">
		<defaultValueExpression><![CDATA["2016-04-01"]]></defaultValueExpression>
	</parameter>
	<parameter name="restriccionFechaConsulta" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA[$P{fecha_consulta} !="0" ? " AND C.fechaconsulta=DATE('"+$P{fecha_consulta}+"') ":" "]]></defaultValueExpression>
	</parameter>
	<parameter name="restriccionFechas" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA[$P{fecha_inicio} !="0" ? " AND A.fecha BETWEEN DATE('"+$P{fecha_inicio}+"') AND DATE('"+$P{fecha_fin}+"')":" "]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[ SELECT initcap(CONCAT_WS(' ',E.primer_nombre,E.segundo_nombre,E.tercer_nombre,E.primer_apellido,E.segundo_apellido,E.apellido_casada)) as nombre_completo,
                 E.telefono_casa as contacto,
                 D.id as id_expediente,D.numero as numero_expediente,
                 to_char(A.fecha,'DD-MM-YYYY') as fecha_retiro,CONCAT_WS(' ',B.hora_ini,B.meridianoini,'-',B.hora_fin,B.meridianofin) as horario,
                 G.nombre as medicamento, to_char(F.cantidad,'9999.99') as cantidad,
                 initcap(H.nombreempleado) as medico,H.id as id_medico,
                 to_char(C.fechaconsulta,'DD-MM-YYYY') as fecha_consulta, C.id as id_historial_clinico,
                 J.nombre as especialidad,
                 C.idestablecimiento as id_establecimiento_prescribe,
                 K.nombre as establecimiento_prescribe,
                 L.nombre as establecimiento_despacha
         FROM farm_recetas A INNER JOIN farm_rangohora B ON (A.id_rangohora=B.id)
             INNER JOIN sec_historial_clinico C ON (C.id=A.idhistorialclinico)
             INNER JOIN mnt_expediente D ON (C.id_numero_expediente=D.id)
             INNER JOIN mnt_paciente E ON (D.id_paciente=E.id)
             INNER JOIN farm_medicinarecetada F ON (F.idreceta=A.id)
             INNER JOIN farm_catalogoproductos G ON (F.idmedicina=G.id)
             INNER JOIN mnt_empleado H ON (C.id_empleado=H.id)
             INNER JOIN mnt_aten_area_mod_estab I ON (C.idsubservicio=I.id)
             INNER JOIN ctl_atencion J ON (I.id_atencion=J.id)
             INNER JOIN ctl_establecimiento K ON (K.id=C.idestablecimiento)
             INNER JOIN ctl_establecimiento L ON (F.id_establecimiento_despacha=L.id)
         WHERE A.id_rangohora IS NOT NULL $P!{restriccionFechaConsulta} $P!{restriccionFechas}
         ORDER BY A.fecha,id_rangohora,nombre_completo]]>
	</queryString>
	<field name="nombre_completo" class="java.lang.String"/>
	<field name="contacto" class="java.lang.String"/>
	<field name="id_expediente" class="java.lang.Long">
		<fieldDescription><![CDATA[Llave Foránea del expediente a asignarle la cita]]></fieldDescription>
	</field>
	<field name="numero_expediente" class="java.lang.String"/>
	<field name="fecha_retiro" class="java.lang.String"/>
	<field name="horario" class="java.lang.String"/>
	<field name="medicamento" class="java.lang.String"/>
	<field name="cantidad" class="java.lang.String">
		<fieldDescription><![CDATA[Valor numerico de medicamentos recetado]]></fieldDescription>
	</field>
	<field name="medico" class="java.lang.String"/>
	<field name="id_medico" class="java.lang.Integer"/>
	<field name="fecha_consulta" class="java.lang.String"/>
	<field name="id_historial_clinico" class="java.lang.Integer"/>
	<field name="especialidad" class="java.lang.String"/>
	<field name="id_establecimiento_prescribe" class="java.lang.Integer"/>
	<field name="establecimiento_prescribe" class="java.lang.String"/>
	<field name="establecimiento_despacha" class="java.lang.String"/>
	<variable name="fecha_retiro_1" class="java.lang.Integer" resetType="Column" calculation="Count">
		<variableExpression><![CDATA[$F{fecha_retiro}]]></variableExpression>
	</variable>
	<group name="fechaRetiroGroup">
		<groupExpression><![CDATA[$F{fecha_retiro}]]></groupExpression>
		<groupHeader>
			<band height="20">
				<rectangle>
					<reportElement stretchType="RelativeToBandHeight" mode="Opaque" x="0" y="0" width="781" height="19" forecolor="#000000" backcolor="#E8E6E6" uuid="24debfa6-02bc-4211-b2cd-27b201c44459"/>
				</rectangle>
				<textField>
					<reportElement stretchType="RelativeToBandHeight" x="136" y="0" width="100" height="20" uuid="dd6a7dcc-f994-42d8-8b8a-893a694128fb"/>
					<textElement verticalAlignment="Middle"/>
					<textFieldExpression><![CDATA[$F{fecha_retiro}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement stretchType="RelativeToBandHeight" x="36" y="0" width="100" height="19" uuid="8d8f60be-eb21-442a-bd07-4018e5eb3a89"/>
					<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1"/>
					<textElement verticalAlignment="Middle">
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Fecha de Retiro:]]></text>
				</staticText>
			</band>
		</groupHeader>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="87" splitType="Stretch">
			<staticText>
				<reportElement stretchType="RelativeToBandHeight" x="0" y="65" width="59" height="20" uuid="28e0d480-1a0c-44d0-b4fc-026ba4bec246"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[NEC]]></text>
			</staticText>
			<staticText>
				<reportElement stretchType="RelativeToBandHeight" x="136" y="65" width="144" height="20" uuid="4d1f77cc-3590-47e0-a424-8c1da82fd78b"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Paciente]]></text>
			</staticText>
			<staticText>
				<reportElement stretchType="RelativeToBandHeight" x="281" y="65" width="76" height="20" uuid="cd080674-3612-48a4-8525-1102033097d6"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Fecha Consulta]]></text>
			</staticText>
			<staticText>
				<reportElement stretchType="RelativeToBandHeight" x="357" y="65" width="135" height="20" uuid="95da9411-ddeb-46aa-b54c-9fc525ca9309"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Medico que Prescribe]]></text>
			</staticText>
			<staticText>
				<reportElement stretchType="RelativeToBandHeight" x="492" y="65" width="100" height="20" uuid="dbfc6f04-1195-4c3c-86bb-968182fecfe3"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Especialidad]]></text>
			</staticText>
			<staticText>
				<reportElement stretchType="RelativeToBandHeight" x="592" y="65" width="123" height="20" uuid="9c021c66-2718-454e-bc53-affb86213c26"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Medicamento]]></text>
			</staticText>
			<staticText>
				<reportElement stretchType="RelativeToBandHeight" x="715" y="65" width="65" height="20" uuid="f9cff30d-a126-46ea-a70a-b753b6a6cf18"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Cantidad]]></text>
			</staticText>
			<staticText>
				<reportElement stretchType="RelativeToBandHeight" x="59" y="65" width="77" height="20" uuid="1e8795e2-c939-4920-8397-8ebe4425fb62"/>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Horario]]></text>
			</staticText>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false">
				<reportElement x="370" y="22" width="294" height="22" uuid="44a7e293-b83f-48fa-b1c6-4376a40d51a3"/>
				<box leftPadding="10"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="9" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{establecimiento_despacha}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="111" y="0" width="553" height="20" uuid="49f56afc-51c1-447e-892a-bba6d3cfea7a"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[República de El Salvador]]></text>
			</staticText>
			<staticText>
				<reportElement x="111" y="12" width="553" height="20" uuid="cdadc843-71a3-4dca-b8eb-cfcc07e3d7a7"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[Sistema Nacional de Salud]]></text>
			</staticText>
			<staticText>
				<reportElement x="111" y="24" width="259" height="20" uuid="a637fef5-b500-4537-8043-2b160cb45cc1"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="9" isBold="false"/>
				</textElement>
				<text><![CDATA[Pacientes y Medicamentos enviados a]]></text>
			</staticText>
			<staticText>
				<reportElement x="111" y="38" width="259" height="20" uuid="490b8491-12d2-4563-9b66-15587112c748"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="9" isBold="false"/>
				</textElement>
				<text><![CDATA[Desde]]></text>
			</staticText>
			<textField isStretchWithOverflow="true">
				<reportElement x="370" y="38" width="294" height="20" uuid="bfd61b32-3137-4ec2-b17d-2b8a8d21e2b6"/>
				<box leftPadding="10"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="9" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{establecimiento_prescribe}]]></textFieldExpression>
			</textField>
			<image>
				<reportElement x="15" y="9" width="56" height="46" uuid="f68ed80c-8497-4e6c-9514-a3d1903acb47"/>
				<imageExpression><![CDATA["repo:/reports/siaps/Reporte_Escudo"]]></imageExpression>
			</image>
			<image scaleImage="FillFrame" isUsingCache="false" onErrorType="Blank">
				<reportElement x="695" y="9" width="63" height="46" uuid="3ad017cd-0f2e-4842-a75c-cf80df9a89c3"/>
				<imageExpression><![CDATA["repo:/reports/siaps/Reporte_Salud"]]></imageExpression>
			</image>
		</band>
	</pageHeader>
	<detail>
		<band height="35" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="0" y="0" width="59" height="35" uuid="6d102caa-053e-4980-b68b-61a29bdfc860"/>
				<box topPadding="5" leftPadding="5" bottomPadding="5" rightPadding="5">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{numero_expediente}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="136" y="0" width="144" height="35" uuid="7b251618-1e27-476f-9c1e-8e839d6f792d"/>
				<box topPadding="5" leftPadding="5" bottomPadding="5" rightPadding="5">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{nombre_completo}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="281" y="0" width="76" height="35" uuid="7ce48b47-bbe3-4e43-b429-7f4434bb488d"/>
				<box topPadding="5" leftPadding="5" bottomPadding="5" rightPadding="5">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{fecha_consulta}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="357" y="0" width="135" height="35" uuid="a5055386-dbe4-47e2-b572-395769f20f56"/>
				<box topPadding="5" leftPadding="5" bottomPadding="5" rightPadding="5">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{medico}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="492" y="0" width="100" height="35" uuid="d04b3b04-b17b-4151-9dad-56c595051b75"/>
				<box topPadding="5" leftPadding="5" bottomPadding="5" rightPadding="5">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{especialidad}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="592" y="0" width="123" height="35" uuid="7ea06605-1452-455d-8223-811323af35a4"/>
				<box topPadding="5" leftPadding="5" bottomPadding="5" rightPadding="5">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{medicamento}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="715" y="0" width="65" height="35" uuid="5cb29a08-aae8-493e-a6c2-c1f0b154e8cf"/>
				<box topPadding="5" leftPadding="5" bottomPadding="5" rightPadding="5">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{cantidad}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="59" y="0" width="77" height="35" uuid="750c1734-2723-4c69-9285-d553a6c9350d"/>
				<box topPadding="5" leftPadding="3" bottomPadding="5" rightPadding="2">
					<pen lineWidth="1.0" lineColor="#000000"/>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#000000"/>
				</box>
				<textFieldExpression><![CDATA[$F{horario}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<pageFooter>
		<band height="15">
			<textField>
				<reportElement x="664" y="0" width="80" height="14" uuid="638ec89f-ee81-4992-83c3-1406ac7be4dc"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA["Página "+$V{PAGE_NUMBER}+" De"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="744" y="0" width="40" height="14" uuid="3c906b08-1439-438a-8171-455f53a5f59c"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
</jasperReport>
