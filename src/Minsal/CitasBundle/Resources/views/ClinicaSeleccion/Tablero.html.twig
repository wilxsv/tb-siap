{% set url_parameters = { '_external': 'true', '_modulo': 'clinica_seleccion', 'tipoPacPertenencia': 'local' } %}
{% extends 'SonataAdminBundle::layout.html.twig' %}

{% block stylesheets %}
    {{parent()}}
    <link href="{{ asset('bundles/minsalcitas/css/cseleccion/bootstrap.vertical-tabs.css') }}" rel="stylesheet" type="text/css" />
    <link  rel="stylesheet"  href="{{ asset('bundles/minsalcitas/css/tabla.css') }} "/>
{% endblock %}

{% block javascripts %}
    {{parent()}}
    <!-- clinica de seleccion -->
    <script src="{{ asset('bundles/minsalcitas/js/Cseleccion.js') }}" type="text/javascript"></script>
    <script type="text/javascript">
        jQuery(document).ready(function ($) {
            var numExpNomPac = $('#sMovito');
            initializeSelect2(numExpNomPac, true, false, {allowClear: true, placeholder: 'Seleccione Motivo...'});
        });
    </script>
    <script type="text/javascript">
        jQuery(document).ready(function ($) {

            var typingTimer;                //timer identifier
            var doneTypingInterval = 500;   //time in ms, 0.5 second for example

            //on keyup, start the countdown
            $("body").on("keyup", 'input#buscar2', function () {
                typingTimer = setTimeout(doneTyping, doneTypingInterval);
            });

            //on keydown, clear the countdown
            $("input#buscar2").keydown(function () {
                // $("body").on( "keydown", 'input#buscar2', function() {
                clearTimeout(typingTimer);
            });

            function doneTyping() {

                var value = $("input#buscar2").val();

                var tabla;
                jQuery(document).ready(function ($) {
                    $.ajax({
                        type: "GET",
                        dataType: 'json',
                        async: false,
                        url: Routing.generate('filtrar'),
                        data: {criterio: value, especialida: $('input#hEspecialidadId').val(), idModalida: $("#cmbModalida").val()},
                        success: function (data)
                        {
                            // eval(div).html(data);
                            tabla = '<table class="  table-hover display " width="100%">';
                            tabla += '<thead><tr>';
                            tabla += '<th width="12%" ></th>';
                            tabla += '<th width="40%" ></th>';
                            tabla += '<th width="5%"  align="center"><h6">Cant. Disponible</h6></th>\
                               <th  width="43%"  ALIGN="right"></th>\
                                             </tr>\
                                             </thead>';

                            if (data.data === false)
                            {
                                tabla += '<tr><td colspan="4"><div class="alert alert-info" role="alert" ><span style="font-size:18px;"><strong> <i class="fa fa-info-circle fa-lg"></i> </strong> Busqueda sin resultado.</span></div></td></tr>';
                            }
                            else {
                                $.each(data.data, function (indice, val) {

                                    var capacidadFormated = parseInt(val.capacidad);
                                    tabla += '<tr class="odd" >';
                                    tabla += '<td class=" " align="center"><div class="icon"><i class="fa fa-user-md fa-4x"></i></div></td>';
                                    if (data.idEsp === 0) {
                                        tabla += '<td class=" " valign="bottom">' + val.nombre_empleado + '(' + val.servicio + ')';
                                    }
                                    else {
                                        tabla += '<td class=" " valign="bottom">' + val.nombre_empleado;
                                    }
                                    if (val.total_citas === 0)
                                    {
                                        tabla += '&nbsp&nbsp<span class="badge bg-green" style="float: right;">' + capacidadFormated + '</span>';
                                    }
                                    else if (val.total_citas !== 0)
                                    {

                                        if (((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.25))
                                        {
                                            tabla += '&nbsp&nbsp<span class="badge bg-green" style="float: right;">' + val.total_citas + '/' + capacidadFormated + '</span>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.25) && ((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.5))
                                        {
                                            tabla += '<span class="badge bg-blue" style="float: right;">' + val.total_citas + '/' + capacidadFormated + '</span>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.5) && ((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.75))
                                        {
                                            tabla += '<span class="badge bg-orange" style="float: right;">' + val.total_citas + '/' + capacidadFormated + '</span>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.75))
                                        {
                                            tabla += '<span class="badge bg-red" style="float: right;">' + val.total_citas + '/' + capacidadFormated + '</span>';
                                        }
                                    }
                                    tabla += '<div class="progress progress-xs progress-striped active ">';
                                    if (val.total_citas === '0')
                                    {
                                        tabla += '<div class="progress-bar progress-bar-green" style="width: 0%; "></div> ';
                                    }
                                    else if (val.total_citas !== 0)
                                    {
                                        if (((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.25))
                                        {
                                            tabla += '<div class="progress-bar progress-bar-green" style="width:' + (val.total_citas / capacidadFormated) * 100 + '%">  </div>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.25) && ((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.5))
                                        {
                                            tabla += '<div class="progress-bar progress-bar-blue" style="width:' + ((val.total_citas / capacidadFormated) * 100) + '%">  </div>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.5) && ((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.75))
                                        {
                                            tabla += '<div class="progress-bar progress-bar-warning" style="width:' + (val.total_citas / capacidadFormated) * 100 + '%">   </div>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.75))
                                        {
                                            tabla += '<div class="progress-bar progress-bar-danger" style="width:' + (val.total_citas / capacidadFormated) * 100 + '%">   </div>';
                                        }
                                    }
                                    tabla += '<td class=" "  align="center">';
                                    if (val.total_citas === 0)
                                    {

                                        tabla += '<span class="badge bg-green" align="right">&nbsp' + (capacidadFormated - val.total_citas) + '</span>';
                                    }
                                    else if ((capacidadFormated - val.total_citas) > 0)
                                    {

                                        if (((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.25))
                                        {

                                            tabla += '<span class="badge bg-green" align="right">' + (capacidadFormated - val.total_citas) + '</span>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.25) && ((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.5))
                                        {
                                            tabla += '<span class="badge bg-blue" align="right">' + (capacidadFormated - val.total_citas) + '</span>';
                                        }

                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.5) && ((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.75))
                                        {
                                            tabla += '<span class="badge bg-orange" align="right">' + (capacidadFormated - val.total_citas) + '</span>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.75))
                                        {
                                            tabla += '<span class="badge bg-red" align="right">' + (capacidadFormated - val.total_citas) + '</span>';
                                        }
                                        else if (capacidadFormated - val.total_citas <= 0)
                                        {
                                            tabla += '<span class="badge bg-red" align="right"> 0</span>';
                                        }

                                    }
                                    tabla += '</td>';
                                    tabla += '</td><td class=" " ALIGN="right"><a class="btn btn-success btn-sm" id="enviar" onClick="asignar(' + val.id_empleado + ',' + val.id_servicio + ',\'' + val.servicio + '\',' + 0 + ')" >';
                                    tabla += '<i class="fa fa-plus-circle"></i> Asignar Cupo</a>';
                                    tabla += '<a class="btn btn-default btn-sm" id="envia" onClick="detalle(' + val.id_empleado + ',' + val.id_servicio + ',\'' + val.servicio + '\')">';
                                    tabla += '<i class="fa fa-tasks"></i> Detalle</a>';
                                    tabla += '<a class="btn btn-info btn-sm" id="deta" onClick="agendaMedica(' + val.id_empleado + ')">';
                                    tabla += '<i class="fa fa-calendar"></i> Agenda Medica</a>';
                                    tabla += '</td></tr>';

                                });
                            }
                            tabla += '</tbody></table> ';

                            // $('#rBusquedas').append(tabla);
                            $('#MBusquedas').html(tabla);
                            //     $('#home').append(tabla);
                        }
                    });
                });
            }
        });
    </script>
    <script type="text/javascript">

        jQuery(document).ready(function ($) {
            var typingTimer;                //timer identifier
            var doneTypingInterval = 500;   //time in ms, 0.5 second for example

            //on keyup, start the countdown
            $("input#hbuscar").keyup(function () {
                typingTimer = setTimeout(doneTyping, doneTypingInterval);
            });

            //on keydown, clear the countdown
            $("input#hbuscar").keydown(function () {
                clearTimeout(typingTimer);
            });

            function doneTyping() {
                var value = $("input#hbuscar").val();
                var tabla;

                jQuery(document).ready(function ($) {
                    $.ajax({
                        type: "GET",
                        dataType: 'json',
                        async: false,
                        url: Routing.generate('filtrar'),
                        data: {criterio: value, especialida: $('input#hEspecialidadId').val(), idModalida: $("#cmbModalida").val()},
                        success: function (data)
                        {
                            // eval(div).html(data);
                            tabla = '<table class="  table-hover display " width="100%">';
                            tabla += '<thead><tr>';
                            tabla += '<th width="12%" ></th>';
                            tabla += '<th width="40%" ></th>';
                            tabla += '<th width="5%"  align="center"><h6">Cant. Disponible</h6></th>\
                                  <th  width="43%"  ALIGN="right"></th>\
                                                </tr>\
                                                </thead>';

                            if (data.data === false)
                            {
                                tabla += '<tr><td colspan="4"><div class="alert alert-info" role="alert" ><span style="font-size:18px;"><strong> <i class="fa fa-info-circle fa-lg"></i> </strong> Busqueda sin resultado.</span></div></td></tr>';
                            }
                            else {
                                $.each(data.data, function (indice, val) {

                                    var capacidadFormated = parseInt(val.capacidad);
                                    tabla += '<tr class="odd" >';
                                    tabla += '<td class=" " align="center"><div class="icon"><i class="fa fa-user-md fa-4x"></i></div></td>';
                                    if (data.idEsp == 0) {
                                        tabla += '<td class=" " valign="bottom">' + val.nombre_empleado + '(' + val.servicio + ')';
                                    }
                                    else {
                                        tabla += '<td class=" " valign="bottom">' + val.nombre_empleado;
                                    }
                                    if (val.total_citas === 0)
                                    {
                                        tabla += '&nbsp&nbsp<span class="badge bg-green" style="float: right;">' + capacidadFormated + '</span>';
                                    }
                                    else if (val.total_citas !== 0)
                                    {

                                        if (((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.25))
                                        {
                                            tabla += '&nbsp&nbsp<span class="badge bg-green" style="float: right;">' + val.total_citas + '/' + capacidadFormated + '</span>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.25) && ((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.5))
                                        {
                                            tabla += '<span class="badge bg-blue" style="float: right;">' + val.total_citas + '/' + capacidadFormated + '</span>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.5) && ((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.75))
                                        {
                                            tabla += '<span class="badge bg-orange" style="float: right;">' + val.total_citas + '/' + capacidadFormated + '</span>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.75))
                                        {
                                            tabla += '<span class="badge bg-red" style="float: right;">' + val.total_citas + '/' + capacidadFormated + '</span>';
                                        }
                                    }
                                    tabla += '<div class="progress progress-xs progress-striped active ">';
                                    if (val.total_citas === '0')
                                    {
                                        tabla += '<div class="progress-bar progress-bar-green" style="width: 0%; "></div> ';
                                    }
                                    else if (val.total_citas !== 0)
                                    {
                                        if (((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.25))
                                        {
                                            tabla += '<div class="progress-bar progress-bar-green" style="width:' + (val.total_citas / capacidadFormated) * 100 + '%">  </div>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.25) && ((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.5))
                                        {
                                            tabla += '<div class="progress-bar progress-bar-blue" style="width:' + ((val.total_citas / capacidadFormated) * 100) + '%">  </div>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.5) && ((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.75))
                                        {
                                            tabla += '<div class="progress-bar progress-bar-warning" style="width:' + (val.total_citas / capacidadFormated) * 100 + '%">   </div>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.75))
                                        {
                                            tabla += '<div class="progress-bar progress-bar-danger" style="width:' + (val.total_citas / capacidadFormated) * 100 + '%">   </div>';
                                        }
                                    }
                                    tabla += '<td class=" "  align="center">';
                                    if (val.total_citas === 0)
                                    {

                                        tabla += '<span class="badge bg-green" align="right">&nbsp' + (capacidadFormated - val.total_citas) + '</span>';
                                    }
                                    else if ((capacidadFormated - val.total_citas) > 0)
                                    {

                                        if (((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.25))
                                        {

                                            tabla += '<span class="badge bg-green" align="right">' + (capacidadFormated - val.total_citas) + '</span>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.25) && ((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.5))
                                        {
                                            tabla += '<span class="badge bg-blue" align="right">' + (capacidadFormated - val.total_citas) + '</span>';
                                        }

                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.5) && ((val.total_citas / capacidadFormated) * capacidadFormated) <= (capacidadFormated * 0.75))
                                        {
                                            tabla += '<span class="badge bg-orange" align="right">' + (capacidadFormated - val.total_citas) + '</span>';
                                        }
                                        else if (((val.total_citas / capacidadFormated) * capacidadFormated) > (capacidadFormated * 0.75))
                                        {
                                            tabla += '<span class="badge bg-red" align="right">' + (capacidadFormated - val.total_citas) + '</span>';
                                        }
                                        else if (capacidadFormated - val.total_citas <= 0)
                                        {
                                            tabla += '<span class="badge bg-red" align="right"> 0</span>';
                                        }

                                    }
                                    tabla += '</td>';
                                    tabla += '</td><td class=" " ALIGN="right"><a class="btn btn-success btn-sm" id="enviar" onClick="asignar(' + val.id_empleado + ',' + val.id_servicio + ',\'' + val.servicio + '\',' + 0 + ')" >';
                                    tabla += '<i class="fa fa-plus-circle"></i> Asignar Cupo</a>';
                                    tabla += '<a class="btn btn-default btn-sm" id="envia" onClick="detalle(' + val.id_empleado + ',' + val.id_servicio + ',\'' + val.servicio + '\')">';
                                    tabla += '<i class="fa fa-tasks"></i> Detalle</a>';
                                    tabla += '<a class="btn btn-info btn-sm" id="deta" onClick="agendaMedica(' + val.id_empleado + ')">';
                                    tabla += '<i class="fa fa-calendar"></i> Agenda Medica</a>';
                                    tabla += '</td></tr>';

                                });
                            }
                            tabla += '</tbody></table> ';

                            // $('#rBusquedas').append(tabla);
                            $('#HBusquedas').html(tabla);
                            //     $('#home').append(tabla);
                        }
                    });
                });
            }
        });

    </script>
    <script type="text/javascript">
        var vtab = null; // para limpiar el contenedor del tab anteriormente seleccionado
        jQuery(document).ready(function ($) {
            var numExpNomPac = $('#sPaciente');
            numExpNomPac.select2({
                allowClear: true,
                placeholder: 'Seleccionar Expediente...',
                minimumInputLength: 1,
                dropdownAutoWidth: true,
                ajax: {
                    url: Routing.generate('citasexpedientepaciente'),
                    dataType: 'json',
                    quietMillis: 1000,
                    data: function (term, page) {
                        return {
                            clue: term, //search term
                            page_limit: 10, // page size
                            page: page, // page number
                        };
                    },
                    results: function (data, page) {
                        var more = (page * 10) < data.data2;
                        return {results: data.data1, more: more};
                    }
                }
            })
        });
    </script>
    <script type="text/javascript">

        function agendaMedica(id)
        {
            var tipo = '2';
        var parameters
            = {{ url_parameters|json_encode|raw }};
                    var winParams = [];

            parameters['tipo'] = tipo;
            parameters['idEmpleado'] = id;

            winParams['method'] = "post";
        winParams['action'] = "{{ url('admin_minsal_citas_citcitasdia_list') }}";
            winParams['target'] = "Asignacion de Cita al Paciente";
            winParams['parameters'] = parameters;
            openPostPopUpWindows(winParams);
        }
    </script>
{% endblock %}
{% block content %}
    {# Definicion de variables#}

    <input type="hidden" name="hEspecialidadId" id="hEspecialidadId" value="">
    <input type="hidden" name="hEspecialidadNombre" id="hEspecialidadNombre" value="">
    <div class="">
        <div class="box box-primary"  style="border-radius: 4px;">
            <div class="box-header"><h3>&nbsp;&nbsp; &nbsp;&nbsp;Clínica de Selección </h3>
                <hr/></div>
            <!-- Inicio de Contenedor de box  -->
            <div class="box-body responsive" id="contenedor">

                <div class="row responsive">
                    <div  class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                        <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2" > <!-- required for floating -->
                            <!-- Nav tabs -->

                            <ul class="nav nav-tabs tabs-left responsive" Style="height:440px;max-height:490px; overflow-y: visible;overflow-x:hidden;" id="ContenAtencion">
                                <li class="active"><a href="#home" data-toggle="tab" onClick="especialidad('0', '0')">Todo</a></li>

                                {% for atencion in atencion %}

                                    <li><a href="#{{atencion.id_especialidad}}" data-toggle="tab" onClick="especialidad('{{atencion.id_especialidad}}')">{{atencion.servicio}}</a></li>
                                    {% endfor %}
                            </ul>
                        </div>


                        <div class="col-xs-10 col-sm-10 col-md-10 col-lg-10">
                            <!-- *****   Filtros   **** -->


                            <div class="row" style="min-height:47px;background-color: #FAFAFA;margin: 0 -15px -25px -30px;">
                                <div  style=" margin: 5px 0 5px 25px;">
                                    <div class="col-sm-1"  {% if tipoEmpleado is empty %}
                                         {%else%}{% if tipoEmpleado=="MED"%}style='display:none;'
                                             {%else%}
                                                 style='display:inline;'
                                             {%endif%}{%endif%}>Modalidad:
                                             </div>
                                             <div class="col-sm-2" {% if tipoEmpleado is empty %} {%else%} {% if tipoEmpleado=="MED"%}style='display:none;'
                                                  {%else%}
                                                      style='display:inline;' {%endif%}   {%endif%}> <select style="width:100%;" name="cmbModalida" id="cmbModalida" onchange="Modalida()">
                                                          {% if result_modalidad is empty %}  {%else%}
                                                              {% for modalidad in result_modalidad %}
                                                                  <option value="{{modalidad.id}}"  {%if(modalidad.nombre=='MINSAL')%}checked='checked'{%endif%}>{{modalidad.nombre}}</option>
                                                              {% endfor %}
                                                          {%endif%}

                                                      </select>

                                                  </div>
                                                  <div class="col-sm-1">Paciente:</div>
                                                  <div class="col-sm-4">
                                                      <input type="text" class="form-control" name="sPaciente" id="sPaciente"/>
                                                  </div>
                                                  <div class="col-sm-1">Prioridad:</div>
                                                  <div class="col-sm-1">
                                                      <select class="" name="sPrioridad" id="sPrioridad" >
                                                          <option value="0">Seleccionar</option>
                                                          {% for prioridad in prioridad %}
                                                              <option value="{{prioridad.id}}">{{prioridad.nombre}}</option>
                                                          {% endfor %}
                                                      </select>
                                                  </div>
                                             </div>
                                         </div>
                                         <!-- *****  fin *****-->

                                         <!-- ---Style="height:435px; overflow-y: auto;overflow-x: hidden;"  -->
                                         <br>
                                         <!-- Tab panes -->
                                         <div class="row" >
                                             <div class="tab-content"  id="conten_div" style="/*height:400px; overflow: auto;*/margin: 5px 0 0 0; position:relative;">

                                                 <!-- Todos los medicos -->
                                                 <div class="tab-pane active" id="home">

                                                     <div style="float: right;margin: 9px 0px 0px -15px;width:200px;">
                                                         <input type="text" class="txtBuscar form-control" id="hbuscar" placeholder="Médico">
                                                     </div>
                                                     <div id="HBusquedas" style="height:335px; overflow: auto;position:absolute;top:53px;right:0px;left:0px;">

                                                     <table  class="table-hover table-responsive " width="100%" style=" margin: 0px 0 0px -5px;">
                                                     <thead>
                                                                 <tr >
                                                                     <th width="12%" ></th>
                                                                     <th    width="40%" ></th>
                                                                     <th     width="5%"  align="center"><h6">Cant. Disponible</h6></th>
                                                             <th  width="43%"  ALIGN="right"></th>
                                                             </tr>
                                                             </thead>
                                                             <tbody >

                                                                 {% for medico in medicos%}
                                                                     <tr class="odd" >
                                                                         <td class=" " align="center">
                                                                             <div class="icon">
                                                                                 <i class="fa fa-user-md fa-4x"></i>
                                                                             </div>
                                                                         </td>
                                                                         <td class=" " valign="bottom">
                                                                             {{medico.nombre_empleado~' ('~medico.servicio~')'}}

                                                                             {%if (medico.total_citas==0) %}

                                                                                 <span class="badge bg-green" align="right" style="float: right;">{{medico.capacidad}}</span>


                                                                             {%elseif (medico.total_citas!=0)%}


                                                                                 {%if (((medico.total_citas/medico.capacidad)*medico.capacidad)<=(medico.capacidad*0.25))%}
                                                                                     <span class="badge bg-green" style="float: right;">{{medico.total_citas}}/{{medico.capacidad}}</span>


                                                                                 {%elseif (((medico.total_citas/medico.capacidad)*medico.capacidad)>(medico.capacidad*0.25)) and (((medico.total_citas/medico.capacidad)*medico.capacidad)<=(medico.capacidad*0.5))%}
                                                                                     <span class="badge bg-blue" style="float: right;">{{medico.total_citas}}/{{medico.capacidad}}</span>

                                                                                 {%elseif (((medico.total_citas/medico.capacidad)*medico.capacidad)>(medico.capacidad*0.5)) and (((medico.total_citas/medico.capacidad)*medico.capacidad)<=(medico.capacidad*0.75))%}
                                                                                     <span class="badge bg-orange" style="float: right;">{{medico.total_citas}}/{{medico.capacidad}}</span>
                                                                                 {%elseif (((medico.total_citas/medico.capacidad)*medico.capacidad)>(medico.capacidad*0.75))%}
                                                                                     <span class="badge bg-red" style="float: right;">{{medico.total_citas}}/{{medico.capacidad}}</span>

                                                                                 {%endif%}
                                                                             {%endif%}

                                                                             <div class="progress progress-xs progress-striped active "  >

                                                                                 {%if (medico.total_citas==0) %}
                                                                                     <div class="progress-bar progress-bar-green" style="width: 0%; ">   </div>

                                                                                 {%elseif (medico.total_citas!=0)%}

                                                                                     {%if (((medico.total_citas/medico.capacidad)*medico.capacidad)<=(medico.capacidad*0.25))%}
                                                                                         <div class="progress-bar progress-bar-green" style="width:{{((medico.total_citas/medico.capacidad)*100)}}%">   </div>

                                                                                     {%elseif (((medico.total_citas/medico.capacidad)*medico.capacidad)>(medico.capacidad*0.25)) and (((medico.total_citas/medico.capacidad)*medico.capacidad)<=(medico.capacidad*0.5))%}
                                                                                         <div class="progress-bar progress-bar-blue" style="width:{{((medico.total_citas/medico.capacidad)*100)}}%">   </div>

                                                                                     {%elseif (((medico.total_citas/medico.capacidad)*medico.capacidad)>(medico.capacidad*0.5)) and (((medico.total_citas/medico.capacidad)*medico.capacidad)<=(medico.capacidad*0.75)) %}
                                                                                         <div class="progress-bar progress-bar-warning" style="width:{{((medico.total_citas/medico.capacidad)*100)}}%">   </div>
                                                                                     {%elseif (((medico.total_citas/medico.capacidad)*medico.capacidad)>(medico.capacidad*0.75))%}
                                                                                         <div class="progress-bar progress-bar-danger" style="width:{{((medico.total_citas/medico.capacidad)*100)}}%">   </div>

                                                                                     {%endif%}
                                                                                 {%endif%}

                                                                             </div>
                                                                         </td>
                                                                         <td class=" "  align="center">
                                                                             {# Cupos disponibles#}

                                                                             {%if (medico.total_citas==0) %}
                                                                                 <span class="badge bg-green" align="right">{{medico.capacidad-medico.total_citas}}</span>

                                                                             {%elseif ((medico.capacidad-medico.total_citas)>0)%}


                                                                                 {%if (((medico.total_citas/medico.capacidad)*medico.capacidad)<=(medico.capacidad*0.25))%}
                                                                                     <span class="badge bg-green" align="right">{{medico.capacidad-medico.total_citas}}</span>

                                                                                 {%elseif (((medico.total_citas/medico.capacidad)*medico.capacidad)>(medico.capacidad*0.25)) and (((medico.total_citas/medico.capacidad)*medico.capacidad)<=(medico.capacidad*0.5))%}
                                                                                     <span class="badge bg-blue" align="right">{{medico.capacidad-medico.total_citas}}</span>
                                                                                 {%elseif (((medico.total_citas/medico.capacidad)*medico.capacidad)>(medico.capacidad*0.5)) and (((medico.total_citas/medico.capacidad)*medico.capacidad)<=(medico.capacidad*0.75))%}
                                                                                     <span class="badge bg-orange" align="right">{{medico.capacidad-medico.total_citas}}</span>
                                                                                 {%elseif (((medico.total_citas/medico.capacidad)*medico.capacidad)>(medico.capacidad*0.75))%}
                                                                                     <span class="badge bg-red" align="right">{{medico.capacidad-medico.total_citas}}</span>
                                                                                 {%endif%}
                                                                             {%elseif (medico.capacidad-medico.total_citas<=0)%}
                                                                                 <span class="badge bg-red" align="right">0</span>

                                                                             {%endif%}

                                                                         </td>
                                                                         <td class=" " ALIGN="right">

                                                                             <a class="btn btn-success btn-sm" id="enviar" onClick="asignar('{{medico.id_empleado}}', '{{medico.id_servicio}}', '{{medico.servicio}}', 0)" >
                                                                                 <i class="fa fa-plus-circle"></i> Asignar Cupo</a>

                                                                             <a class="btn btn-default btn-sm" id="envia" onClick="detalle('{{medico.id_empleado}}', '{{medico.id_servicio}}', '{{medico.servicio}}')">
                                                                                 <i class="fa fa-tasks"></i> Detalle</a>
                                                                             <a class="btn btn-info btn-sm"  onClick="agendaMedica('{{medico.id_empleado}}')">
                                                                                 <i class="fa fa-calendar"></i> Agenda Medica</a>

                                                                         </td>
                                                                     </tr>
                                                                 {%endfor%}
                                                             </tbody>
                                                         </table>
                                                     </div>
                                                     {#% embed 'MinsalCitas:ClinicaSeleccion:contenido.html.twig' %}{% endembed %#}

                                                 </div>
                                                 <!-- Fin -->
                                                 <!--  Contenedor de tab dinamico -->
                                                 <!--  <div id="conten_div"></div> -->
                                                 {% for atencion in atencion %}
                                                     <div id="{{atencion.id_especialidad}}" class="tab-pane"></div>
                                                 {% endfor %}
                                                 <!-- fin -->

                                             </div>
                                         </div>
                                         <!-- Fin de Tab conten-->
                                    </div>
                                </div>

                            </div>

                            <!-- Fin de Contenedor de box  -->

                        </div>
                    </div>
                </div>


                <!-- Modal agenda dia-->
                <div class="modal fade modal_detalle" id="modal_detalle" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header " >
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cerrar</span></button>
                                <center>  <span  style="font-weight: bold; font-size:20px;color:#1E90FF;text-align:center;width: 100%;">Agenda del Día</span> </center>

                                <span  style="font-weight: bold; font-size:18px;color:#1E90FF;" id="empleado"></span><br>
                                <span  style="font-weight: bold; font-size:16px;color:#1E90FF;" id="fecha"></span>
                            </div>
                            <div class="modal-body" id="modal_body_detalle" Style="text-align:right; margin: 2px 3px -13px 3px;">
                                <nav class="navbar navbar-default" >
                                    <div class="container-fluid">
                                        <!-- Brand and toggle get grouped for better mobile display -->
                                        <div class="navbar-header"></div>
                                        <div class="navbar-custom-menu ">
                                            <ul class="nav navbar-nav">
                                                <li class="dropdown messages-menu">
                                                    <a style="font-weight: bold; font-size:16px;">Código de Colores: </a>

                                                </li>
                                                <li class="dropdown messages-menu" ><div style="height:17px;width:17px; margin: 18px -12px -5px -5px; background-color:#FFC0CB;"></div>
                                                </li>
                                                <li class="dropdown messages-menu" ><a style="font-weight: bold; font-size:16px;">Prioridad I</a></li>
                                                <li class="dropdown messages-menu" ><div style="height:17px;width:17px; margin: 18px -12px -5px -5px; background-color:#FFFACD;" ></div>
                                                </li>
                                                <li class="dropdown messages-menu">
                                                    <a style="font-weight: bold; font-size:16px;">Prioridad II</a>
                                                </li>
                                                <li class="dropdown messages-menu" ><div style="height:17px;width:17px; margin: 18px -12px -5px -5px;background-color: #99D699;" ></div>

                                                <li class="dropdown messages-menu">
                                                    <a style="font-weight: bold; font-size:16px;">Prioridad III</a>
                                                </li>
                                                <li class="dropdown messages-menu" ><div style="  border:1px solid silver;background-color: #ffffff;height:17px;width:17px; margin: 18px -12px -5px -5px;" ></div>

                                                <li class="dropdown messages-menu">
                                                    <a style="font-weight: bold; font-size:16px;">Citados</a>
                                                </li>
                                                <li class="dropdown messages-menu" ><div style="background-color: #E0E0E0;height:17px;width:17px; margin: 18px -12px -5px -5px;" ></div>

                                                <li class="dropdown messages-menu">

                                                    <a style="font-weight: bold; font-size:13px;">Consulta Recibida/Consulta en Proceso</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </nav>

                                <table class="table-hover table"  style="background-color:#ffffff; border: 1px solid #E6E6FA;">
                                    <thead>
                                        <tr >
                                            <th width="5%" align="center">No</th>
                                            <th width="10%" align="center">Expediente</th>
                                            <th width="40%" align="center">Nombre del Paciente</th>
                                            <th width="15%" align="center">Estado de Cita</th>
                                            <th width="10%" align="center">Fecha/Hora Asignacion</th>
                                            <th width="10%" align="center">Prioridad</th>
                                            <th width="9%"  align="center">Comprobante</th>
                                        </tr>
                                    </thead>

                                    <tbody  id="detalle" >
                                    </tbody>
                                </table>
                            </div>
                            <div class="modal-footer" id="botones" Style="height:50px;">
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Modal cita dia-->
                <div class="modal fade modal" id="modal_cita" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header " Style="min-height:35px;">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cerrar</span></button>
                                <center>   <span  style="font-weight: bold; font-size:20px;color:#1E90FF;">Asignación de Citas Médicas</span>  </center>
                            </div>
                            <div class="modal-body" id="modal_body" Style=" margin: 2px 3px -13px 3px;">
                            </div>
                            <div class="modal-footer" id="botom" Style="height:50px;">
                            </div>

                        </div>
                    </div>
                    {% endblock %}
