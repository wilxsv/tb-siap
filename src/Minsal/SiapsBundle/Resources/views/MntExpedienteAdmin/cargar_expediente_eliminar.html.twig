{% block javascripts %}
    <script type="text/javascript">
        jQuery(document).ready(function ($) {
            var tablaResultados=$('#tablaResultados');
            var opcionesTable=setDataTableOptions(tablaResultados);
            opcionesTable['sort']=false;
            opcionesTable['displayLength']=15;
            opcionesTable['filter']=false;
            opcionesTable['dom'] = "<'row'<'col-sm-6'l><'col-sm-6'fp>>" +
                                   "<'row'<'col-sm-12 table-responsive'tr>>" +
                                   "<'row'<'col-sm-5'i>>";
            opcionesTable['aLengthMenu']= [[15,25, 50, 75, -1], [15,25, 50, 75, "Todos"]];
            tablaResultados.DataTable(opcionesTable);

            $('.deshabilitarExpediente').on('click',function(){
                var expediente=$(this).attr('numeroExpediente');
                var idExpediente=$(this).attr('idExpediente');
                var accion=$(this).attr('accion');
                var title='Confirmación';
                if (accion=='deshabilitar'){
                    var body="¿Esta seguro que desea eliminar el Expediente Número:  <strong style=\"color:#367fa9;font-size: 14px\">"+expediente+"</strong> ?";
                }else{
                    var body="¿Esta seguro que desea activar el Expediente Número:  <strong style=\"color:#367fa9;font-size: 14px\">"+expediente+"</strong> ?";
                }

                var width='750px'
                var clase='dialog-warning';
                var arrayBtns = [
                    {
                        text: 'Confirmar', click: function() {
                            $.ajax({
                                url: Routing.generate("cambiar_estado_expediente", {'idExpediente': idExpediente,'accion':accion}),
                                async: false,
                                dataType: 'json',
                                success: function (data) {
                                    cargarResultados();
                                }
                            });
                            $(this).dialog('close');
                        }
                    },
                    {
                        text: 'Cancelar', click: function( event, ui) {
                            $(this).dialog('close');
                        }
                    }
                ];
                showDialogMsg(title, body, clase, '', arrayBtns, false, width, true);
            });
        });
    </script>
{% endblock %}
<table id="tablaResultados" class="table table-bordered table-hover" data-table-enabled="true">
    <thead>
        <tr>
            <th>Acciones</th>
            <th>NEC</th>
            <th>Apellidos</th>
            <th>Nombres</th>
            <th>Fecha de Nacimiento</th>
            <th>Documento</th>
            <th>Nombre Madre</th>
            <th>Hoja de Identificación</th>
        </tr>
    </thead>
    <tbody>
        {% for paciente in pacientes %}
            {% if paciente['numero'] is not sameas ('EM') %}
                {% if (not paciente['numero_temporal'] and not paciente['expediente_fisico_eliminado']) or (paciente['numero_temporal'] and paciente['expediente_fisico_eliminado']) %}
                    <tr>
                      <td>
                          {% if paciente['expediente_fisico_eliminado'] %}
                                <a style="color: #FFFFFF" href="#" class="btn btn-success deshabilitarExpediente"
                                  numeroExpediente='{{ paciente['numero'] }}'
                                  idExpediente='{{ paciente['id_expediente'] }}'
                                  accion='habilitar'
                                 >
                                    <span class="glyphicon glyphicon-plus"></span>
                                 Habilitar Expediente </a>
                             {% else %}
                                 <a style="color: #FFFFFF" href="#" class="btn btn-danger deshabilitarExpediente"
                                    numeroExpediente='{{ paciente['numero'] }}'
                                    idExpediente='{{ paciente['id_expediente'] }}'
                                    accion='deshabilitar'
                                >
                                     <span class="glyphicon glyphicon-trash"></span>
                                  Eliminar Expediente </a>
                              {% endif %}
                      </td>
                      <td >{{ paciente['numero'] }}</td>
                      <td>{{ paciente['primer_apellido']~' '~paciente['segundo_apellido']~' '~paciente['apellido_casada'] }}</td>
                      <td>{{ paciente['primer_nombre']~' '~paciente['segundo_nombre']~' '~paciente['tercer_nombre'] }}</td>
                      <td>{{ paciente['fecha_nacimiento']|date('d/m/Y')}}</td>
                      <td>{{ (paciente['nombre']?paciente['nombre']~':'~(paciente['numero_doc_ide_paciente']?paciente['numero_doc_ide_paciente']:'-'):'')}}</td>
                      <td>{{ paciente['nombre_madre']}}</td>
                      <td><a target="_blank" href="{{ path('_report_paciente',{'report_name':'hoja_datos_paciente','report_format':'PDF', 'paciente':paciente['id']})}}" class="btn btn-info"><span class="fa fa-file-text"></span>Hoja Identificación</a></td>
                  </tr>
                  {% endif %}
              {% endif %}
        {% endfor %}
    </tbody>
</table>
