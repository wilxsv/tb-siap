{# src/Minsal/SiapsBudle/Resource/view/MntExpedienteAdmin/listarexpedientes.html.twig
   Vista para el reporte de los expedientes creados por un determinido recurso del
   establecimiento #}
{% extends 'SonataAdminBundle::layout.html.twig' %}
{% block stylesheets %}
    {{parent()}}
<link rel="stylesheet" href="{{ asset('bundles/minsalsiaps/css/MntExpediente/list.css') }}" type="text/css" media="all" />
{% endblock %}


{% block javascripts %}
    {{parent()}}
<script src="{{ asset('bundles/minsalsiaps/js/maskedinput/jquery.maskedinput.js') }}" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {
    $("#fecha_inicio").mask("99/99/9999");
    $("#fecha_fin").mask("99/99/9999");

    $field = $('#usuario');
    $field.prepend('<option/>').val(function() {
        return
        $('[selected]', this).val();
    })
    $field.select2({
        placeholder: 'Seleccione...',
        allowClear: true,
        width: '90%'
    });
    $.getJSON(Routing.generate('obtener_usuarios_archivo'),
            function(data) {
                $.each(data.usuarios, function(indice, aux) {
                    $field.append($('<option>', {value: aux.id, text: aux.firstname + ' ' + aux.lastname}));
                });
            });

    $("#emitir_informe").click(function(event) {
        if ($("#fecha_inicio").val() == '' || $("#fecha_fin").val() == '') {
            var title='Error de Llenado';
            var body="La fecha de inicio debe de ser menor que la fecha fin.";
            var clase='dialog-error';
            var arrayBtns = [{text: 'Cerrar',
                                    click: function( event, ui) {
                                        jQuery( this ).dialog( "close" );
                                        $("#fecha_inicio").val('');
                                        $("#fecha_fin").val('');
                                        $("#fecha_inicio").focus();
                                    }}
                            ];
            showDialogMsg(title, body, clase, '', arrayBtns, false, null, true);
            event.preventDefault();
        } else if ($("#fecha_inicio").datepicker("getDate") > $("#fecha_fin").datepicker("getDate")) {
            var title='Error de Llenado';
            var body="La fecha de inicio debe de ser menor que la fecha fin.";
            var clase='dialog-error';
            var arrayBtns = [{text: 'Cerrar',
                                    click: function( event, ui) {
                                        jQuery( this ).dialog( "close" );
                                        $("#fecha_inicio").val('');
                                        $("#fecha_fin").val('');
                                        $("#fecha_inicio").focus();
                                    }}
                            ];
            showDialogMsg(title, body, clase, '', arrayBtns, false, null, true);
            event.preventDefault();
        } else {
            $('#resultado').empty();
            $('#resultado').append('<center><img id="wait" src="{{ asset("bundles/minsalsiaps/imagenes/wait_icon1.gif") }}" alt="wait" width="24" height="24"><div id="search-message">Por Favor Espere...</div></center>');
            $('#resultado').load(Routing.generate('expedientes_creados',{'datos':$('#expedientes_creados').serialize()}));
        }
        event.preventDefault();
    });
});
</script>

{% endblock %}

{% block sonata_admin_content -%}
<div style="text-align: center;">
    <form  id="expedientes_creados" method="post" >
        <table class="table table-bordered ">
            <tbody>
                <tr>
                    <td colspan="4" id="titulo_parametro" class="sonata-ba-list-field-header"><strong>Opciones de Contenido</strong></td>
                </tr>
                <tr>
                    <td class=""><strong>Fecha Inicial</strong></td>
                    <td><input id="fecha_inicio" name="fecha_inicio" type="text" class="fecha bootstrap-datepicker now form-control" /></td>
                    <td class=" "><strong>Fecha Final</strong></td>
                    <td><input id="fecha_fin" name="fecha_fin" type="text" class="fecha bootstrap-datepicker now form-control" /></td>
                </tr>
                <tr>
                    <td colspan="2"><strong>Persona que registro expediente</strong></td>
                    <td colspan="2"><select  class="span3" id="usuario" name="usuario"></select></td>
                </tr>
            </tbody>
        </table>
        <div class="well form-actions">
            <input type="submit" class="btn btn-primary" id="emitir_informe" name="btn_generate" value="Emitir Informe"/>
            <input type="submit" class="btn btn-info" name="btn_cancel" value="Cancelar"/>
        </div>
    </form>
    <div id="resultado" ></div>
</div>
{% endblock -%}
