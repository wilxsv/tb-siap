{# src/Minsal/SiapsBudle/Resource/view/MntExpedienteAdmin/listarexpedientes.html.twig
   Vista para el reporte de los expedientes creados por un determinido recurso del
   establecimiento #}
{% extends 'SonataAdminBundle::layout.html.twig' %}
{% block stylesheets %}
    {{parent()}}
    <link rel="stylesheet" href="{{ asset('bundles/minsalsiaps/css/MntExpediente/list.css') }}" type="text/css" media="all" />
{% endblock %}

{% block javascripts %}
    {{parent()}}
    <script src="{{ asset('bundles/minsalsiaps/js/maskedinput/jquery.maskedinput.js') }}" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var eAnioInicio = $("#anioInicio");
            var eAnioFin = $("#anioFin");
            eAnioInicio.mask("9999");
            eAnioFin.mask("9999");
            var eResultado = $('#resultado');
            eResultado.hide();

            var eIdResultado = $('#idResultado');
            $("#emitir_informe").click(function () {
                if (eAnioInicio.val() == '') {
                    showDialogMsg('Llenado de valores', 'Debe de digitar el año de inicio para generar el Informe', 'dialog-error');
                    eAnioInicio.focus();
                } else if (eAnioInicio.val().length < 4) {
                    showDialogMsg('Llenado de valores', 'El año de inicio debe contener cuatro digitos', 'dialog-error');
                    eAnioInicio.focus();
                } else if (eAnioFin.val() == '') {
                    showDialogMsg('Llenado de valores', 'Debe de digitar el año de fin para generar el Informe', 'dialog-error');
                    eAnioFin.focus();
                } else if (eAnioFin.val().length < 4) {
                    showDialogMsg('Llenado de valores', 'El año fin debe contener cuatro digitos', 'dialog-error');
                    eAnioFin.focus();
                } else if (parseInt(eAnioFin.val()) < parseInt(eAnioInicio.val())) {
                    showDialogMsg('Llenado de valores', 'El año de finalización debe ser menor que el año de inicio', 'dialog-error');
                    eAnioInicio.val('');
                    eAnioFin.val('');
                } else {
                    $("#idResultado td").remove();
                    jQuery.ajax({
                        url: Routing.generate('expedientes_creados_listado_anio', {anioInicio: eAnioInicio.val(), anioFin: eAnioFin.val()}),
                        async: false,
                        dataType: 'json',
                        timeout: 8000, // 8 sec
                        success: function (data) {

                            var i = 1;
                            $.each(data.expedientes, function (indice, expediente) {
                                eIdResultado.append($('<tr><td>' + expediente.anio + '</td><td><center>' + expediente.cuantos + '</center></td><tr>'));
                            });
                            eResultado.show();
                        },
                        error: function (xhr, textStatus, errorThrown) {
                            showDialogMsg('Error...', 'Hubo un error al intentar cargar las regiones', 'dialog-error');
                        }
                    });
                }
                return false;
            });

        });

    </script>

{% endblock %}

{% block sonata_admin_content -%}
    <div style="text-align: center;">
        <form  id="expedientes_creados" method="post" >
            <table class="table table-bordered ">
                <tbody>
                    <tr>
                        <td colspan="4" id="titulo_parametro" class="sonata-ba-list-field-header"><strong>Opciones de Contenido</strong></td>
                    </tr>
                    <tr>
                        <td class=""><strong>Año de Inicio:</strong></td>
                        <td><input id="anioInicio" name="anioInicio" type="integer" class="fecha" /></td>
                        <td class=""><strong>Año de Finalización:</strong></td>
                        <td><input id="anioFin" name="anioFin" type="integer" class="fecha" /></td>
                    </tr>
                </tbody>
            </table>
            <div class="well form-actions">
                <input type="button" class="btn btn-primary" id="emitir_informe" name="btn_generate" value="Emitir Informe"/>
                <input type="button" class="btn btn-info" name="btn_cancel" value="Cancelar"/>
            </div>
        </form>
        <center>
            <div id="resultado" >
                <table id="idResultado" class="table table-bordered table-hover" style="width: 20%">
                    <tr>
                        <th>Año</th>
                        <th>Cantidad de Expedientes Creados</th>
                    </tr>
                </table>
            </div>
        </center>
    </div>
{% endblock -%}
